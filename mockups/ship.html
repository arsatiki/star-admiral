<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
    <title>Battle Simulator</title>
    
    <style type="text/css" media="screen">
        canvas { border: 1px solid white; }
    </style>

    <link rel="stylesheet" href="css/simu.css" type="text/css"
          media="screen" title="no title" charset="utf-8">

    <script type="text/javascript" src="js/utils.js"></script>
    <script type="text/javascript" src="js/anim.js"></script>
    <script type="text/javascript" src="js/ships.js"></script>
        
    <script type="text/javascript" charset="utf-8">
    function run() {
        console.log("Go");
        var canvas = document.getElementById("canv");
        var k; ships = [];
        
        var n_ships = 7;
        
        ctx = canvas.getContext("2d");
        var scene = Object.create(CanvasManager).fromElement(canvas);
        
        var framerate = 25;
        s = Object.create(Ship);
        
        s.load_icon("pics/ship.png");
        s.pos = Vec2.new_at(0, 300);
        //s.ang_vel = Math.PI/12;
        //s.vel = Vec2.new_at(10, 0);

        var alpha;
        for (k = 0; k < n_ships; k++) {
            ships[k] = Object.create(s);
            
            var r = 200;
            alpha = k * 2*Math.PI / n_ships;

            ships[k].pos = Vec2.new_at(400, 300).iadd(Vec2.radial(r, alpha));
            
            ships[k].angle = Math.PI + alpha + Math.PI/4.4;
            ships[k].vel = Vec2.radial(5, ships[k].angle);
            ships[k].ang_vel = -0.005;
            
            scene.add(ships[k]);
        }
        
        for (k = 0; k < ships.length; k++) {
            var aggressor = ships[k];
            var target = ships[(k - 2 + ships.length) % ships.length];
            var sources = [aggressor.local(14, 20), aggressor.local(26, 20)];
            
            var opts = {level: k, width: 2+k/2};
            
            scene.add(
                Beam.fire(sources, target.local(20, 25), opts),
                {z: 1, TTL: 5+2*k}
            );
        }

        setInterval(function() {
            scene.update(1/framerate);
            scene.draw({clear: true});
            
        }, 1000/framerate);
    }
    </script>
    

    
          

</head>
<body onload="run()">
    <div id="wrapper">
        <canvas id="canv" width="800" height="600"> </canvas>
    </div>
            
</body>